generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Medication {
  id                   Int           @id @default(autoincrement())
  name                 String
  schedule             Schedule
  unit                 Unit
  currentStockQuantity Int           @default(0)
  transactions         Transaction[]
}

model User {
  id                  Int           @id @default(autoincrement())
  email               String        @unique
  name                String
  role                UserRole
  nurseTransactions   Transaction[] @relation("NurseTransactions")
  witnessTransactions Transaction[] @relation("WitnessTransactions")
  auditLogs           AuditLog[]    @relation("AuditLogsPerformedBy")
}

model Transaction {
  id           Int             @id @default(autoincrement())
  medication   Medication      @relation(fields: [medicationId], references: [id])
  medicationId Int
  nurse        User            @relation("NurseTransactions", fields: [nurseId], references: [id])
  nurseId      Int
  witness      User            @relation("WitnessTransactions", fields: [witnessId], references: [id])
  witnessId    Int
  type         TransactionType
  quantity     Int
  notes        String?
  timestamp    DateTime        @default(now())
}

model AuditLog {
  id            Int      @id @default(autoincrement())
  action        String
  entityType    String
  entityId      Int
  performedBy   User     @relation("AuditLogsPerformedBy", fields: [performedById], references: [id])
  performedById Int
  details       Json
  timestamp     DateTime @default(now())
}

enum Schedule {
  II
  III
  IV
  V
}

enum Unit {
  mg
  ml
  mcg
}

enum UserRole {
  NURSE
  WITNESS
  ADMIN
}

enum TransactionType {
  CHECKOUT
  RETURN
  WASTE
}
